#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

PROGRAM=$(basename "${0}")

function usage() {
  cat<<EOF
usage: ${PROGRAM} HOSTNAME

Change OS X hostname to HOSTNAME.
EOF
}

function die() {
  printf "%s: %s\n" "${PROGRAM}" "${@}" >&2
  exit 1
}

function main() {
  local hostname=${1:-}

  while getopts 'h' opt; do
    case $opt in
      h)
        usage
        return
        ;;
      *)
        usage
        return 1
        ;;
    esac
  done

  shift $(( OPTIND-1 ))

  [[ -n "${hostname}" ]] || { usage; return 1; }

  [[ $EUID -eq 0 ]] || die 'must be root'

  scutil --set ComputerName "$1"
  scutil --set LocalHostName "$1"
  scutil --set HostName "$1"
}

main "${@}"
